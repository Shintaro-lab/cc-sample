# 画面仕様

## 画面遷移図

```
[アプリ起動]
    │
    ├─ authenticated == False
    │   │
    │   └─ [認証画面]
    │       ├─ [ログインタブ] ──成功──→ [タスク管理画面]
    │       └─ [新規登録タブ] ──成功──→ [タスク管理画面]（自動ログイン経由）
    │
    └─ authenticated == True
        │
        └─ [タスク管理画面]
            ├─ [ログアウトボタン] ──→ [認証画面]
            └─ [編集ボタン] ──→ [タスク編集フォーム]（インライン表示）
```

**画面遷移の仕組み**: `st.rerun()` によるページ全体の再描画。`session_state.authenticated` の値に基づいて `app.py:main()` が表示画面を決定する。

---

## 共通要素

### サイドバー（常時表示）

`app.py:main()` で描画。認証状態に関わらず表示される。

| 要素 | タイプ | 説明 |
|---|---|---|
| タイトル | `st.title` | 「タスク管理アプリ」 |
| 配色モード | `st.selectbox` | 「ライト」/「ダーク」の選択肢。変更時にテーマCSS再注入＋ `st.rerun()` |
| 区切り線 | `st.markdown("---")` | テーマ選択と以下のコンテンツを分離 |

サイドバーの追加コンテンツは認証状態により異なる:
- **未認証時**: なし
- **認証済み時**: ログイン情報、ログアウトボタン、タスク追加フォーム、タスク統計（後述）

---

## 認証画面

### 表示条件
`session_state.authenticated == False` のとき表示。

### レイアウト — `auth/pages.py:show_login_register_ui()`

```
[メインエリア]
┌─────────────────────────────────┐
│ タスク管理アプリ（st.title）       │
│                                 │
│ ┌──────────┬──────────┐         │
│ │ ログイン  │ 新規登録  │ ← タブ  │
│ ├──────────┴──────────┤         │
│ │                     │         │
│ │  （選択タブの内容）    │         │
│ │                     │         │
│ └─────────────────────┘         │
└─────────────────────────────────┘
```

### ログインタブ — `auth/pages.py:login_form()`

| 要素 | タイプ | key | 説明 |
|---|---|---|---|
| ヘッダー | `st.header` | - | 「ログイン」 |
| ユーザー名 | `st.text_input` | `login_username` | テキスト入力 |
| パスワード | `st.text_input` (password) | `login_password` | パスワード入力（マスク表示） |
| ログインボタン | `st.form_submit_button` | - | 「ログイン」 |

**バリデーション**:
| チェック | エラーメッセージ |
|---|---|
| ユーザー名 or パスワードが空 | 「ユーザー名とパスワードを入力してください」 |
| ユーザー名が存在しない | 「ユーザー名が見つかりません」 |
| パスワード不一致 | 「パスワードが正しくありません」 |

### 新規登録タブ — `auth/pages.py:register_form()`

| 要素 | タイプ | key | 説明 |
|---|---|---|---|
| ヘッダー | `st.header` | - | 「アカウント登録」 |
| ユーザー名 | `st.text_input` | `register_username` | テキスト入力 |
| パスワード | `st.text_input` (password) | `register_password` | パスワード入力（マスク表示） |
| パスワード（確認） | `st.text_input` (password) | `confirm_password` | パスワード確認入力（マスク表示） |
| 登録ボタン | `st.form_submit_button` | - | 「登録」 |

**バリデーション**（チェック順序）:
| 順序 | チェック | エラーメッセージ |
|---|---|---|
| 1 | ユーザー名 or パスワードが空 | 「ユーザー名とパスワードは必須です」 |
| 2 | パスワード != 確認パスワード | 「パスワードが一致しません」 |
| 3 | パスワード長 < 6 | 「パスワードは6文字以上にしてください」 |
| 4 | ユーザー名重複 | 「このユーザー名は既に使用されています」 |

---

## タスク管理画面

### 表示条件
`session_state.authenticated == True` のとき表示。

### 全体レイアウト — `tasks/pages.py:tasks_page()`

```
[サイドバー]                    [メインエリア]
┌───────────────────┐          ┌──────────────────────────────┐
│ タスク管理アプリ     │          │ タスク管理（st.title）         │
│ 配色モード [▼]      │          │                              │
│ ──────────────     │          │ タスクフィルター（st.subheader） │
│ ログイン中: {user}  │          │ ┌────────┬────────┬────────┐  │
│ [ログアウト]        │          │ │ステータス│ 優先度  │カテゴリ │  │
│ ──────────────     │          │ │  [▼]   │  [▼]   │  [▼]  │  │
│ タスク追加          │          │ └────────┴────────┴────────┘  │
│ ┌─────────────┐   │          │                              │
│ │ タイトル*     │   │          │ 🔴 タスクA 🔼 #カテゴリ  [▶] │
│ │ 説明         │   │          │ 🟠 タスクB ➖           [▶] │
│ │┌─────┬─────┐│   │          │ 🟢 タスクC 🔽 #仕事     [▶] │
│ ││ステータス│優先度││   │          │                              │
│ ││カテゴリ │期限  ││   │          └──────────────────────────────┘
│ │└─────┴─────┘│   │
│ │[タスクを追加]  │   │
│ └─────────────┘   │
│ ──────────────     │
│ タスク統計          │
│ 合計: N件          │
│ ステータス別: ...   │
│ 優先度別: ...      │
└───────────────────┘
```

### サイドバー: ログイン情報・ログアウト — `auth/pages.py:show_logout_ui()`

| 要素 | タイプ | 説明 |
|---|---|---|
| ログイン中表示 | `st.sidebar.write` | 「ログイン中: {username}」 |
| ログアウトボタン | `st.sidebar.button` | 「ログアウト」 |

### サイドバー: タスク追加フォーム — `tasks/pages.py:add_task_form()`

フォーム名: `add_task_form`

| 要素 | タイプ | 配置 | key | 説明 |
|---|---|---|---|---|
| タイトル* | `st.text_input` | 全幅 | - | 必須項目 |
| 説明 | `st.text_area` | 全幅 | - | 任意項目 |
| ステータス | `st.selectbox` | 左列 (col1) | - | 選択肢: 未着手/進行中/完了。初期値: 未着手 |
| カテゴリ | `st.text_input` | 左列 (col1) | - | 自由入力 |
| 優先度 | `st.selectbox` | 右列 (col2) | - | 選択肢: 低/中/高。初期値: 中 |
| 期限 | `st.date_input` | 右列 (col2) | - | YYYY/MM/DD形式。min_value=今日 |
| タスクを追加 | `st.form_submit_button` | 全幅 | - | 送信ボタン |

### サイドバー: タスク統計 — `tasks/pages.py:show_task_stats()`

| 要素 | タイプ | 説明 |
|---|---|---|
| ヘッダー | `st.subheader` | 「タスク統計」 |
| 合計タスク数 | `st.write` | 「合計タスク数: {N}」 |
| ステータス別 | `st.write` | 各ステータスの件数とパーセンテージ |
| 優先度別 | `st.write` | 各優先度の件数とパーセンテージ |

タスクが0件の場合は「タスクがありません」（`st.info`）のみ表示。

### メインエリア: フィルター — `tasks/pages.py:task_filters()`

3カラムレイアウト:

| 要素 | タイプ | 配置 | key | 選択肢 |
|---|---|---|---|---|
| ステータスでフィルター | `st.selectbox` | col1 | `status_filter` | すべて / 未着手 / 進行中 / 完了 |
| 優先度でフィルター | `st.selectbox` | col2 | `priority_filter` | すべて / 低 / 中 / 高 |
| カテゴリでフィルター | `st.selectbox` | col3 | `category_filter` | すべて / {動的カテゴリ一覧} |

フィルター値は `session_state.task_filters` に保存される。「すべて」選択時は `None` として保存。

### メインエリア: タスクカード — `tasks/pages.py:show_task_card()`

各タスクは `st.expander` で表示される。

**エキスパンダーヘッダー**:
```
{ステータスアイコン} {タイトル} {優先度アイコン} [#{カテゴリ}]
```
- カテゴリがある場合のみ `#{カテゴリ}` を表示

**エキスパンダー内部**:

| 要素 | 条件 | 表示内容 |
|---|---|---|
| 説明 | descriptionが存在する場合 | 「**説明:** {description}」 |
| 期限 | due_dateが存在する場合 | 「**期限:** YYYY/MM/DD」 |
| 期限警告 | 期限超過 かつ ステータス≠completed | 「期限が過ぎています」（`st.warning`） |

**アクションボタン**（3カラム均等配置）:

| ボタン | key | 条件 | 動作 |
|---|---|---|---|
| 完了 | `complete_{task_id}` | ステータスが `completed` でない場合のみ表示 | `update_task(status="completed")` → `st.rerun()` |
| 編集 | `edit_{task_id}` | 常時表示 | `session_state.editing_task = task` → `st.rerun()` |
| 削除 | `delete_{task_id}` | 常時表示 | `delete_task()` → `st.rerun()` |

### メインエリア: タスク編集フォーム — `tasks/pages.py:edit_task_form()`

**表示条件**: `session_state.editing_task` が存在し、そのIDが当該タスクのIDと一致する場合、タスクカードの直下にインライン表示。

フォーム名: `edit_task_form_{task_id}`

| 要素 | タイプ | 配置 | 初期値 | 説明 |
|---|---|---|---|---|
| タイトル* | `st.text_input` | 全幅 | 現在のタイトル | 必須 |
| 説明 | `st.text_area` | 全幅 | 現在の説明（NULLなら空文字） | 任意 |
| ステータス | `st.selectbox` | 左列 | 現在のステータス | 未着手/進行中/完了 |
| カテゴリ | `st.text_input` | 左列 | 現在のカテゴリ（NULLなら空文字） | 自由入力 |
| 優先度 | `st.selectbox` | 右列 | 現在の優先度 | 低/中/高 |
| 期限 | `st.date_input` | 右列 | 現在の期限日（NULLならNone） | `min_value=None`（過去日付も許可） |
| 更新 | `st.form_submit_button` | 左列 | - | 更新実行 |
| キャンセル | `st.form_submit_button` | 右列 | - | 編集モード終了 |

**追加フォームとの差異**:
- 期限日の `min_value` が `None`（追加時は `datetime.date.today()`）。既存の過去日付を保持するため
- キャンセルボタンがある
- `session_state.editing_task` の削除によりフォームを非表示にする

---
