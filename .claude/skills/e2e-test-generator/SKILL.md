---
name: e2e-test-generator
description: 指定した機能グループのE2Eテストケース表を生成する。引数に機能グループ名を渡すと、プロジェクト内の仕様書を読み取り、テンプレートに従ったテストケース表を作成する。「E2Eテスト」「テストケース作成」「テストケース表」などのキーワードで発動する。
argument-hint: "[機能グループ名] 例: auth, task-management, ui"
---

# E2Eテストケース表ジェネレーター

機能グループ `$ARGUMENTS` のE2Eテストケース表を、プロジェクト内の仕様書から生成してMarkdownファイルとして出力する。

## 実行手順

### 1. 引数の確認

`$ARGUMENTS` を機能グループ名として使用する。
引数が空の場合、ユーザーに機能グループ名を確認する。

### 2. プロジェクト構造の把握

CLAUDE.md を読み、以下を把握する:
- ドキュメントの配置場所
- 機能ID体系やモジュール構成

CLAUDE.md が存在しない場合、プロジェクトルートの構造を Glob で探索する。

### 3. テンプレートの検出

プロジェクト内でE2Eテストケースのテンプレートを探す:

1. Glob で `**/template*/**e2e*` や `**/e2e*template*` を検索
2. 見つかればそのテンプレートの形式に従う
3. 見つからなければ以下のデフォルト形式を使用する:

| No | 機能ID | 機能名 | 前提条件 | 操作手順 | 期待結果 |
|----|--------|--------|----------|----------|----------|

### 4. 仕様書の動的探索

指定された機能グループに関連する仕様書を探す:

1. Grep で機能グループ名（例: `auth`, `task`）をプロジェクト内の `*.md` から検索
2. 機能ID（例: `F-AUTH-`, `F-TASK-`）を含むドキュメントを特定
3. 画面仕様・DB定義など関連ドキュメントも収集する
4. 見つからなければユーザーに仕様書のパスを確認する

### 5. テストケースの設計

仕様書から以下の方針でテストケースを網羅的に抽出する:

**正常系**:
- 各機能IDにつき、基本的な正常系テストケースを最低1件
- 入力パターンが複数ある場合は代表的なパターンを網羅

**異常系・境界値**:
- バリデーションエラー（必須項目未入力、形式不正など）
- 境界値（文字数上限、日付の過去/未来など）
- 権限エラー（未ログイン状態でのアクセスなど）

**テストケース記載ルール**:
- `No`: ファイル内連番（1, 2, 3...）
- `機能ID`: 仕様書の機能ID
- `機能名`: 正常系/異常系を明記（例: 「ログイン（正常系）」「ログイン（パスワード不一致）」）
- `前提条件`: テスト開始時の状態を具体的に記載
- `操作手順`: 番号付きでユーザー操作を具体的に記載
- `期待結果`: 操作後に期待される画面表示・状態変化を具体的に記載

### 6. 出力先の決定・ファイル出力

出力先を以下の優先順で決定する:

1. 機能グループの仕様書が見つかった場合、そのフォルダに配置
2. いずれもなければユーザーに確認する

ファイル名: `e2e-test-{機能グループ名}.md`

テンプレートの構造に従い、以下を埋めて出力する:

```markdown
# E2Eテストケース表: {機能グループの日本語名}

## 対象画面

- {仕様書から特定した対象画面}

## 関連ドキュメント

- {読み込んだ仕様書へのパス}

---

## テストケース表

| No | 機能ID | 機能名 | 前提条件 | 操作手順 | 期待結果 |
|----|--------|--------|----------|----------|----------|
| ... | ... | ... | ... | ... | ... |
```

### 7. Agent Teamによるテストケース検証

生成したテストケースの「期待結果」が仕様書と一致しているかを、Agent Teamで分担して検証・修正する。

#### 7-1. 検証チームの作成

`TeamCreate` で検証チーム `e2e-verify-{機能グループ名}` を作成する。

#### 7-2. テストケースの分割・タスク登録

生成したテストケースをほぼ均等に2〜3グループに分割し、各グループを `TaskCreate` で検証タスクとして登録する。タスクには以下を記載する:
- 担当テストケース番号（例: No.1〜10）
- 仕様書ファイルパス
- テストケースファイルパス

#### 7-3. チームメイトの起動・検証実行

`Task` ツール（`subagent_type: general-purpose`, `team_name: e2e-verify-{機能グループ名}` 指定）でチームメイトを起動し、以下を指示する:
- 担当テストケースの「期待結果」を1件ずつ仕様書と突き合わせて検証する
- 矛盾・不正確な記述があれば `Edit` ツールでテストケースファイルを直接修正する
- 修正した内容を `SendMessage` でリーダーに報告する

#### 7-4. 完了待ち・シャットダウン・クリーンアップ

1. 全チームメイトの検証完了を待つ
2. 各チームメイトに `SendMessage`（`type: shutdown_request`）でシャットダウンを要求する
3. 全チームメイトのシャットダウン後、`TeamDelete` でチームリソースをクリーンアップする

### 8. 完了報告

生成したテストケースの概要を報告する:
- 出力ファイルパス
- テストケース総数
- 機能IDごとの内訳（正常系/異常系）
- 検証で修正があった場合は修正サマリー（修正したケース番号・修正内容）
